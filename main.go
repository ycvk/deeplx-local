package main

import (
	"deeplx-local/service"
	"deeplx-local/web"
	"encoding/base64"
	"errors"
	"github.com/getlantern/systray"
	"github.com/getlantern/systray/example/icon"
	"github.com/gin-gonic/gin"
	"github.com/ycvk/endless"
	"io"
	"log"
	"net/http"
	"strings"
)

const base64Icon = "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"

func main() {
	systray.Run(onReady, onExit)
}

func onReady() {
	reader := base64.NewDecoder(base64.StdEncoding, strings.NewReader(base64Icon))
	winIcon, err := io.ReadAll(reader)
	if err != nil {
		winIcon = icon.Data
	}
	systray.SetIcon(winIcon)
	systray.SetTitle("deeplx local")
	systray.SetTooltip("Deeplx Local Service")
	mQuit := systray.AddMenuItem("Quit", "Quit the app")
	go func() {
		<-mQuit.ClickedCh
		systray.Quit()
	}()

	// 启动Gin服务
	go func() {
		initServer() // 初始化服务
		autoScan()   // 自动扫描
		exitV1()     // 监听退出
		select {}
	}()
}

func onExit() {

}

func initServer() {
	// 从文件中读取并处理URL
	urLs := getValidURLs()

	// 注册服务
	gin.SetMode(gin.ReleaseMode)
	r := gin.Default()
	balancerService := service.NewLoadBalancer(&urLs)
	lxHandler := web.NewDeepLXHandler(balancerService, routePath)
	lxHandler.RegisterRoutes(r)

	go func() {
		if err := endless.ListenAndServe("0.0.0.0:62155", r); err != nil && !errors.Is(err, http.ErrServerClosed) {
			log.Fatal("web服务启动失败: ", err)
		}
	}()
}
